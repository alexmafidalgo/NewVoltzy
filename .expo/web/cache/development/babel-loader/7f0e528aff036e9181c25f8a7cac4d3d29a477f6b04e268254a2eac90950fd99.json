{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as firebaseSignOut, updateProfile } from 'firebase/auth';\nimport { collection, doc, getDocs, query, setDoc, where, limit } from 'firebase/firestore';\nimport { auth, db } from \"./config\";\nexport function signUp(_x) {\n  return _signUp.apply(this, arguments);\n}\nfunction _signUp() {\n  _signUp = _asyncToGenerator(function* (_ref) {\n    var name = _ref.name,\n      username = _ref.username,\n      email = _ref.email,\n      password = _ref.password;\n    var cred = yield createUserWithEmailAndPassword(auth, email, password);\n    yield updateProfile(cred.user, {\n      displayName: name\n    });\n    var userDoc = {\n      uid: cred.user.uid,\n      name: name,\n      username: username,\n      email: email,\n      createdAt: new Date().toISOString()\n    };\n    yield setDoc(doc(db, 'users', cred.user.uid), userDoc);\n    return cred.user;\n  });\n  return _signUp.apply(this, arguments);\n}\nexport function signIn(_x2, _x3) {\n  return _signIn.apply(this, arguments);\n}\nfunction _signIn() {\n  _signIn = _asyncToGenerator(function* (identifier, password) {\n    if (identifier.includes('@')) {\n      var _cred = yield signInWithEmailAndPassword(auth, identifier, password);\n      return _cred.user;\n    }\n    var q = query(collection(db, 'users'), where('username', '==', identifier), limit(1));\n    var snap = yield getDocs(q);\n    if (snap.empty) throw new Error('No user found with that username');\n    var user = snap.docs[0].data();\n    var cred = yield signInWithEmailAndPassword(auth, user.email, password);\n    return cred.user;\n  });\n  return _signIn.apply(this, arguments);\n}\nexport function signOut() {\n  return _signOut.apply(this, arguments);\n}\nfunction _signOut() {\n  _signOut = _asyncToGenerator(function* () {\n    yield firebaseSignOut(auth);\n  });\n  return _signOut.apply(this, arguments);\n}","map":{"version":3,"names":["createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","firebaseSignOut","updateProfile","collection","doc","getDocs","query","setDoc","where","limit","auth","db","signUp","_x","_signUp","apply","arguments","_asyncToGenerator","_ref","name","username","email","password","cred","user","displayName","userDoc","uid","createdAt","Date","toISOString","signIn","_x2","_x3","_signIn","identifier","includes","q","snap","empty","Error","docs","data","_signOut"],"sources":["C:/Users/alexm/Documents/Ensino superior/Ano3 Semestre1/Computação Móvel e Ubíqua/NewVoltzy/src/firebase/auth.ts"],"sourcesContent":["import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as firebaseSignOut, updateProfile } from 'firebase/auth';\r\nimport { collection, doc, getDocs, query, setDoc, where, limit } from 'firebase/firestore';\r\nimport { auth, db } from './config';\r\n\r\ntype SignUpData = {\r\n  name: string;\r\n  username: string;\r\n  email: string;\r\n  password: string;\r\n};\r\n\r\nexport async function signUp({ name, username, email, password }: SignUpData) {\r\n  // create user with email/password\r\n  const cred = await createUserWithEmailAndPassword(auth, email, password);\r\n  // set display name\r\n  await updateProfile(cred.user, { displayName: name });\r\n\r\n  // store additional profile data in Firestore\r\n  const userDoc = {\r\n    uid: cred.user.uid,\r\n    name,\r\n    username,\r\n    email,\r\n    createdAt: new Date().toISOString()\r\n  };\r\n  await setDoc(doc(db, 'users', cred.user.uid), userDoc);\r\n  return cred.user;\r\n}\r\n\r\nexport async function signIn(identifier: string, password: string) {\r\n  // identifier may be email or username. Try email first.\r\n  if (identifier.includes('@')) {\r\n    const cred = await signInWithEmailAndPassword(auth, identifier, password);\r\n    return cred.user;\r\n  }\r\n\r\n  // search for user by username in Firestore\r\n  const q = query(collection(db, 'users'), where('username', '==', identifier), limit(1));\r\n  const snap = await getDocs(q);\r\n  if (snap.empty) throw new Error('No user found with that username');\r\n  const user = snap.docs[0].data() as any;\r\n  const cred = await signInWithEmailAndPassword(auth, user.email, password);\r\n  return cred.user;\r\n}\r\n\r\nexport async function signOut() {\r\n  await firebaseSignOut(auth);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}